---
title: syndesmos协议
---

- [1. syndesmos协议](#1-syndesmos协议)
- [2. 通道](#2-通道)
- [3. 信号](#3-信号)
  - [3.1. A通道](#31-a通道)
  - [3.2. B通道](#32-b通道)
  - [3.3. C通道](#33-c通道)
  - [3.4. D通道](#34-d通道)
  - [3.5. E通道](#35-e通道)
- [4. 序列化](#4-序列化)
- [5. 操作码](#5-操作码)
- [6. 权限](#6-权限)
  - [6.1. 权限转换](#61-权限转换)

# 1. syndesmos协议

原型：[TileLink](https://www.sifive.com/document-file/tilelink-spec-1.9.3)

---

syndesmos协议用于Cache与内存之间的通信。由于ylikou只有一级Cache，且采用哈佛结构，syndesmos只包含了TL-C一致性等级的内容，删除了TL-UL和TL-UH级。

# 2. 通道

syndesmos一共有5个通道，每个通道都是半工通信，其中A、C、E通道的通信方向与链接方向一致，B、D通道的通信方向与链接方向相反。5个通道分别负责不同的工作，它们之间的优先级关系为$A<B<C<D<E$。

# 3. 信号

**通道作用总览**

|通道|方向|作用|
|:--|:--|:--|
|A|主$\rightarrow$从|请求某地址的数据|
|B|从$\rightarrow$主|请求已缓存的数据|
|C|主$\rightarrow$从|响应已缓存的数据|
|D|从$\rightarrow$主|响应某地址的数据|
|E|主$\rightarrow$从|结束缓存块传输的握手|

**通道方向表示**

|类型|方向|描述|
|:--|:--|:--|
|X|输入|时钟或复位信号|
|C|通道方向|控制信号|
|D|通道方向|数据信号|
|V|通道方向|有效信号，指示C/D信号合法性|
|R|反方向|就绪信号，指示V信号被接受|

**链接参数**

|参数|描述|
|:--|:--|
|$w$|数据总线宽度字节数|
|$a$|地址字段位数|
|$z$|大小字段位数|
|$o$|区分所有主设备的最少位数|

## 3.1. A通道

|信号|类型|宽度|描述|
|:--|:--|:--|:--|
|a_code|C|$2$|操作码，允许的操作为`AcquireBlock`或`AcqiorePerm`|
|a_param|C|$3$|参数，表示请求的目标权限，允许的值为`Grow`组|
|a_size|C|$z$|数据字节数的对数值，表示请求的总数据量|
|a_source|C|$o$|主设备标识符|
|a_address|C|$a$|地址，自然对齐|
|a_mask|D|$w$|掩码|
|a_valid|V|$1$| |
|a_ready|R|$1$| |

## 3.2. B通道

|信号|类型|宽度|描述|
|:--|:--|:--|:--|
|b_code|C|$2$|操作码，允许的操作为`ProbeBlock`或`ProbePerm`|
|b_param|C|$3$|参数，表示探测的目标权限，允许的值为`Cap`组|
|b_size|C|$z$|数据字节数的对数值，表示探测的总数据量|
|b_source|C|$o$|主设备标识符|
|b_address|C|$a$|地址，自然对齐|
|b_mask|D|$w$|掩码|
|b_valid|V|$1$| |
|b_ready|R|$1$| |

## 3.3. C通道

|信号|类型|宽度|描述|
|:--|:--|:--|:--|
|c_code|C|$2$|操作码，允许的操作为`ProbeAck[Data]`或`Release[Data]`|
|c_param|C|$3$|参数，表示释放的目标权限，允许的值为`Prune`或`Report`组|
|c_size|C|$z$|数据字节数的对数值，表示释放的总数据量|
|c_source|C|$o$|主设备标识符|
|c_address|C|$a$|地址，自然对齐|
|c_data|D|$8w$|载荷，释放的实际数据|
|c_valid|V|$1$| |
|c_ready|R|$1$| |

## 3.4. D通道

|信号|类型|宽度|描述|
|:--|:--|:--|:--|
|d_code|C|$2$|操作码，允许的操作为`Grant[Data]`或`ReleaseAck`|
|d_param|C|$3$|参数，表示授权的目标权限，允许的值为`Cap`组|
|d_size|C|$z$|数据字节数的对数值，表示授权的总数据量|
|d_source|C|$o$|主设备标识符|
|d_data|D|$8w$|载荷，授权的实际数据|
|d_valid|V|$1$| |
|d_ready|R|$1$| |

## 3.5. E通道

|信号|类型|宽度|描述|
|:--|:--|:--|:--|
|e_valid|V|$1$| |
|e_ready|R|$1$| |

!!! E通道只有一种操作，即`GrantAck`，无需额外字段

# 4. 序列化

当传输的数据大小比数据总线宽度大时，按照地址从低到高依次多周期传输。

# 5. 操作码

|命令|操作码|A|B|C|D|E|响应|
|:--|:--|:--|:--|:--|:--|:--|:--|
|`AcquireBlock`|`0`|y|.|.|.|.|`GrantData`|
|`AcquirePerm`|`1`|y|.|.|.|.|`Grant`|
|`Grant`|`0`|.|.|.|y|.|`GrantAck`|
|`GrantData`|`1`|.|.|.|y|.|`GrantAck`|
|`GrantAck`|`-`|.|.|.|.|y| |
|`ProbeBlock`|`0`|.|y|.|.|.|`ProbeAckData`|
|`ProbePerm`|`1`|.|y|.|.|.|`ProbeAck`|
|`ProbeAck`|`0`|.|.|y|.|.| |
|`ProbeAckData`|`1`|.|.|y|.|.| |
|`Release`|`2`|.|.|y|.|.|`ReleaseAck`|
|`ReleaseData`|`3`|.|.|y|.|.|`ReleaseAck`|
|`ReleaseAck`|`2`|.|.|.|y|.|`GrantAck`|

# 6. 权限

为保证数据一致性，每个缓存块具有权限。根据某个数据块在一致性树中的位置，分为4个结点类型。

**无**

此类型结点未缓存数据，无任何权限。

**主干**

根和顶部之间的结点，无任何权限。缓存的数据可能是过时的。

**顶部**

有读写权限，可能有脏数据。

**分支**

位于顶部上方的结点，有只读权限。

## 6.1. 权限转换

|分组|内容|
|:--|:--|
|`Cap`|`toN(0)`，`toB(1)`，`toT(2)`|
|`Grow`|`NtoB(0)`，`NtoT(1)`，`BtoT(2)`|
|`Prune`|`TtoB(0)`，`TtoN(1)`，`BtoN(2)`|
|`Report`|`TtoT(3)`，`BtoB(4)`，`NtoN(5)`|

其中，`N`，`B`和`T`分别代表无权限结点，分支结点和顶部结点。
